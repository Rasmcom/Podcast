<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø°Ø§Ø¹Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø°ÙƒÙŠØ© - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…Ø·ÙˆØ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background-image: url('https://img.freepik.com/free-photo/close-up-microphone-speech-official-event_23-2151054269.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            position: relative;
        }
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.3);
            z-index: -1;
        }
        .broadcast-content h3 {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: #1e3a8a;
        }
        .broadcast-content p, .broadcast-content blockquote {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #1f2937;
        }
        .glass-container {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .header-new-bg {
            background-image: url('https://img.freepik.com/free-photo/abstract-2d-colorful-wallpaper-with-grainy-gradients_23-2151001646.jpg');
            background-size: cover;
            background-position: center;
        }
        .student-name {
            color: #1e3a8a;
            font-weight: bold;
        }
        .broadcast-card {
            position: relative;
            padding: 1.5rem;
            padding-right: 2.5rem;
            margin-bottom: 1.5rem;
            border-radius: 0.75rem;
            border-right-width: 8px;
        }
        /* Floating Button Styles */
        .floating-button {
            position: fixed;
            top: 25px;
            left: 25px;
            z-index: 1000;
            display: flex;
            align-items: center;
            padding: 6px;
            background-color: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border-radius: 50px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            text-decoration: none;
            color: #003a46;
            font-weight: 700;
            transition: all 0.3s ease-in-out;
        }
        .floating-button:hover {
            background-color: rgba(255, 255, 255, 0.9);
            transform: translateY(-2px) scale(1.03);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
        }
        .floating-button img {
            width: 35px;
            height: 35px;
            border-radius: 50%;
        }
        .floating-button span {
            margin-right: 10px;
            margin-left: 6px;
            font-size: 0.9rem;
        }
        /* Tab Styles */
        .tab-button {
            transition: all 0.3s ease;
        }
        .tab-button.active {
            background-color: #2563eb;
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .tab-button:not(.active) {
             background-color: white;
             color: #1e3a8a;
        }

        /* --- STYLES FOR DYNAMIC SECTIONS (Manual Mode) --- */
        .section-card {
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            position: relative;
            transition: all 0.3s ease;
        }
        .section-card:hover {
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .section-controls {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            justify-content: flex-end;
        }
        .control-btn {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: background-color 0.2s;
            border: 1px solid #ddd;
        }
        .btn-up, .btn-down { background-color: #f3f4f6; color: #374151; }
        .btn-up:hover, .btn-down:hover { background-color: #d1d5db; }
        .btn-delete { background-color: #fee2e2; color: #991b1b; border-color: #fca5a5; }
        .btn-delete:hover { background-color: #fecaca; }
        
        .section-title-input {
            font-weight: bold;
            color: #1e3a8a;
            border: none;
            background: transparent;
            border-bottom: 2px solid #e5e7eb;
            width: 100%;
            margin-bottom: 0.5rem;
            padding: 0.25rem;
            font-size: 1.1rem;
        }
        .section-title-input:focus {
            outline: none;
            border-color: #3b82f6;
            background-color: rgba(255,255,255,0.5);
        }
    </style>
</head>
<body class="text-gray-900">

    <!-- Pledge Modal -->
    <div id="pledge-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-lg text-center transform transition-all glass-container">
            <div class="flex justify-center items-center gap-4 mb-4">
                <img src="https://k.top4top.io/p_35163lq2x1.gif" alt="ØªØ¹Ù‡Ø¯" class="h-20 w-20 rounded-full object-cover border-4 border-blue-200">
                <h2 class="text-3xl font-bold text-blue-900">ØªØ¹Ù‡Ø¯</h2>
            </div>
            <p class="text-gray-700 leading-relaxed mb-6">
                Ø£Ù‚Ø± ÙˆØ£ØªØ¹Ù‡Ø¯ Ø£Ù…Ø§Ù… Ø§Ù„Ù„Ù‡ Ø£Ù†Ù†ÙŠ Ø³Ø£Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø´Ø®ØµÙŠØ© ÙÙ‚Ø·ØŒ ÙˆÙ„Ù† Ø£Ø³ØªØ®Ø¯Ù…Ù‡ Ù„Ø£ÙŠ ØºØ±Ø¶ ØªØ¬Ø§Ø±ÙŠ Ø£Ùˆ Ø±Ø¨Ø­ÙŠ. ÙƒÙ…Ø§ Ø£ØªØ¹Ù‡Ø¯ Ø¨Ø¹Ø¯Ù… Ù…Ø´Ø§Ø±ÙƒØ© Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø¹ Ø£ÙŠ Ø´Ø®Øµ Ø¢Ø®Ø±.
            </p>
            <p class="text-gray-600 font-semibold mb-6">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø£ÙˆØ§ÙÙ‚" Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
            <button id="agree-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg text-lg transition duration-300 w-full mb-8 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">Ø£ÙˆØ§ÙÙ‚</button>
            <hr>
            <div class="mt-6">
                <p class="text-gray-800 mb-4">Ù„Ø·Ù„Ø¨Ø§ØªÙƒÙ… ÙŠØ´Ø±ÙÙ†Ø§ ØªÙˆØ§ØµÙ„ÙƒÙ… Ø¹Ù„Ù‰ Ù…ØªØ¬Ø± Ø±Ø³Ù… Ù„Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©.</p>
                <a href="https://www.rasmcom.com" target="_blank" rel="noopener noreferrer">
                    <img src="https://e.top4top.io/p_3463x5tj40.png" alt="Ø´Ø¹Ø§Ø± Ù…ØªØ¬Ø± Ø±Ø³Ù…" class="h-20 w-auto mx-auto transition-transform duration-300 hover:scale-110">
                </a>
            </div>
        </div>
    </div>

    <div id="main-app" class="hidden">
        <div class="container mx-auto p-4 sm:p-6 lg:p-8">
            <!-- Header -->
            <header class="text-center mb-8 p-6 rounded-xl shadow-lg text-white header-new-bg">
                <div class="relative bg-black bg-opacity-20 p-4 rounded-lg">
                    <div class="flex justify-center items-center gap-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>
                        <h1 class="text-3xl sm:text-4xl font-bold" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">Ø¥Ø°Ø§Ø¹Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø°ÙƒÙŠØ©</h1>
                    </div>
                </div>
                <p class="mt-2 font-medium" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.7);">Ù…ÙˆÙ„Ù‘Ø¯ Ø§Ù„Ø¥Ø°Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</p>
            </header>

            <!-- Mode Tabs -->
            <div class="flex justify-center mb-6 rounded-lg shadow-md overflow-hidden max-w-sm mx-auto">
                <button id="automatic-mode-btn" class="tab-button w-1/2 px-6 py-3 font-bold active">Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</button>
                <button id="manual-mode-btn" class="tab-button w-1/2 px-6 py-3 font-bold">Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙŠØ¯ÙˆÙŠ</button>
            </div>

            <!-- Automatic Controls Section -->
            <div id="automatic-controls">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8 p-6 rounded-xl shadow-lg glass-container">
                    <div class="min-w-0">
                        <label for="topic" class="block mb-2 text-sm font-medium text-gray-700">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹:</label>
                        <select id="topic" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"></select>
                    </div>
                    <div class="min-w-0">
                        <label for="broadcast-date-input" class="block mb-2 text-sm font-medium text-gray-700">Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
                        <input type="date" id="broadcast-date-input" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                    </div>
                    <div class="min-w-0">
                        <label for="gender" class="block mb-2 text-sm font-medium text-gray-700">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù†Ø³:</label>
                        <select id="gender" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                            <option value="boys" selected>Ø¨Ù†ÙŠÙ†</option>
                            <option value="girls">Ø¨Ù†Ø§Øª</option>
                        </select>
                    </div>
                    <div class="min-w-0">
                        <label for="supervisor" class="block mb-2 text-sm font-medium text-gray-700">Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±Ù/Ù€Ø©:</label>
                        <input type="text" id="supervisor" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="Ø£. ÙÙ„Ø§Ù† Ø§Ù„ÙÙ„Ø§Ù†ÙŠ">
                    </div>
                </div>
            </div>

            <!-- Manual Controls Section (DYNAMIC) -->
            <div id="manual-controls" class="hidden">
                 <!-- Saved broadcasts management -->
                <div class="p-6 mb-8 rounded-xl shadow-lg glass-container">
                     <h3 class="text-xl font-bold mb-4 text-blue-900">Ø§Ù„Ø¥Ø°Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h3>
                     <div class="flex flex-col sm:flex-row items-end gap-4">
                        <div class="flex-grow w-full">
                            <label for="saved-broadcasts-select" class="block mb-2 text-sm font-medium text-gray-700">Ø§Ø®ØªØ± Ø¥Ø°Ø§Ø¹Ø© Ù„ØªØ­Ù…ÙŠÙ„Ù‡Ø§ Ø£Ùˆ Ø­Ø°ÙÙ‡Ø§:</label>
                            <select id="saved-broadcasts-select" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"></select>
                        </div>
                        <div class="flex gap-2 w-full sm:w-auto">
                           <button id="load-manual-btn" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg">ØªØ­Ù…ÙŠÙ„</button>
                           <button id="delete-manual-btn" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg">Ø­Ø°Ù</button>
                        </div>
                     </div>
                </div>
                <!-- Manual input form -->
                <div class="p-6 rounded-xl shadow-lg glass-container mb-8">
                     <h3 class="text-xl font-bold mb-4 text-blue-900">Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø°Ø§Ø¹Ø© ÙŠØ¯ÙˆÙŠØ© (ÙÙ‚Ø±Ø§Øª Ù…Ø±Ù†Ø©)</h3>
                     
                     <div class="mb-6">
                        <label for="manual-broadcast-name" class="block text-sm font-medium text-gray-700">Ø§Ø³Ù… Ø§Ù„Ø¥Ø°Ø§Ø¹Ø© (Ù„Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ø¹Ø±Ø¶)</label>
                        <input type="text" id="manual-broadcast-name" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Ù…Ø«Ø§Ù„: Ø¥Ø°Ø§Ø¹Ø© Ø¹Ù† Ø§Ù„ØµØ¯Ø§Ù‚Ø©">
                     </div>

                     <!-- Dynamic Sections Container -->
                     <div id="manual-sections-container" class="space-y-4">
                        <!-- Sections injected by JS -->
                     </div>

                     <button id="add-new-section-btn" class="mt-4 w-full border-2 border-dashed border-blue-300 text-blue-700 hover:bg-blue-50 font-bold py-3 px-4 rounded-lg transition duration-300 flex justify-center items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                        Ø¥Ø¶Ø§ÙØ© ÙÙ‚Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©
                    </button>

                     <div class="mt-8 flex justify-end border-t pt-4">
                        <button id="save-manual-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition">Ø­ÙØ¸ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø¥Ø°Ø§Ø¹Ø©</button>
                     </div>
                </div>
            </div>

            <!-- Broadcast Display Section -->
            <main id="broadcast-display" class="p-4 sm:p-6 rounded-xl shadow-lg min-h-[500px] glass-container">
                <div class="flex flex-wrap justify-between items-center mb-6 border-b-2 pb-4 border-gray-300 gap-4">
                    <div>
                        <h2 id="broadcast-title" class="text-2xl sm:text-3xl font-bold text-blue-900"></h2>
                        <p id="broadcast-date-display" class="text-gray-600"></p>
                    </div>
                    <div class="flex gap-2">
                        <button id="add-names-button" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 flex items-center gap-2 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><line x1="20" y1="8" x2="20" y2="14"></line><line x1="23" y1="11" x2="17" y2="11"></line></svg>
                            <span>Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø·Ù„Ø§Ø¨</span>
                        </button>
                        <button id="print-button" class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 flex items-center gap-2 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>
                            <span>Ø·Ø¨Ø§Ø¹Ø©</span>
                        </button>
                    </div>
                </div>
                <div id="broadcast-content" class="broadcast-content">
                    <!-- Content injected here -->
                </div>
            </main>

            <!-- Footer -->
            <footer class="text-center mt-8 font-semibold">
                 <div class="flex justify-center items-center gap-4 p-4 rounded-xl glass-container max-w-lg mx-auto text-black">
                    <a href="https://t.me/+SJnY9vPy7yo5YmI1" target="_blank" rel="noopener noreferrer">
                        <img src="https://e.top4top.io/p_3463x5tj40.png" alt="Ø´Ø¹Ø§Ø± Ø±Ø³Ù…" class="h-16 w-auto transition-transform duration-300 hover:scale-110">
                    </a>
                    <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù‚Ù†Ø§Ø© Ø±Ø³Ù… Ù„Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© 2025</p>
                </div>
            </footer>
        </div>
    </div>

    <!-- Dynamic Names Modal -->
    <div id="names-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 modal-overlay opacity-0 pointer-events-none">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md m-4 transform scale-95 transition-transform duration-300 glass-container max-h-[90vh] overflow-y-auto">
            <h3 class="text-2xl font-bold mb-6 text-center text-blue-800">Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
            
            <div id="dynamic-names-container" class="space-y-4">
                <!-- Fields generated by JS -->
            </div>

            <div class="mt-8 flex justify-end gap-3">
                <button id="close-modal-button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg">Ø¥ØºÙ„Ø§Ù‚</button>
                <button id="save-names-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <!-- Floating Button -->
    <a href="mtabaa1.html" target="_blank" class="floating-button">
        <img src="https://d.top4top.io/p_3526q3pyw1.gif" alt="Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø£Ø¯Ø§Ø© Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©">
        <span>Ø£Ø¯Ø§Ø© Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¥Ø°Ø§Ø¹Ø©</span>
    </a>

    <script>
        // --- DATA STORE ---
        // (You can add more topics here as in previous versions)
        const broadcasts = [
            { topic: "Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ", quran: "ï´¿ÙˆÙØ¹ÙÙ„ÙÙ‘Ù…Ù Ø¢Ø¯ÙÙ…Ù Ø§Ù„Ù’Ø£ÙØ³Ù’Ù…ÙØ§Ø¡Ù ÙƒÙÙ„ÙÙ‘Ù‡ÙØ§ï´¾ [Ø§Ù„Ø¨Ù‚Ø±Ø©: 31]", hadith: "Ù‚Ø§Ù„ Ø±Ø³ÙˆÙ„ Ø§Ù„Ù„Ù‡ ï·º: â€œØ¥Ù† Ø§Ù„Ù„Ù‡ ÙŠØ­Ø¨ Ø¥Ø°Ø§ Ø¹Ù…Ù„ Ø£Ø­Ø¯ÙƒÙ… Ø¹Ù…Ù„Ø§Ù‹ Ø£Ù† ÙŠØªÙ‚Ù†Ù‡â€", didYouKnow: "Ù‡Ù„ ØªØ¹Ù„Ù… Ø£Ù† Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙŠØ³Ø§Ø¹Ø¯ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ© ÙÙŠ Ù‡ÙˆØ§ØªÙÙ†Ø§ Ù…Ø«Ù„ Ø³ÙŠØ±ÙŠ ÙˆÙ…Ø³Ø§Ø¹Ø¯ Ø¬ÙˆØ¬Ù„ØŸ", wisdom: "Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù‡Ùˆ ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ø§Ù„Ù‚Ø±Ù† Ø§Ù„Ø­Ø§Ø¯ÙŠ ÙˆØ§Ù„Ø¹Ø´Ø±ÙŠÙ†.", morningWord: "Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù‡Ùˆ Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¨Ø´Ø±ÙŠ ÙÙŠ Ø§Ù„Ø¢Ù„Ø§Øª. Ø¥Ù†Ù‡ Ø£Ø¯Ø§Ø© Ù‚ÙˆÙŠØ© ØªØ³Ø§Ø¹Ø¯Ù†Ø§ ÙÙŠ Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø§Øª Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø© ÙÙŠ Ø§Ù„Ø·Ø¨ ÙˆØ§Ù„Ù‡Ù†Ø¯Ø³Ø© ÙˆØºÙŠØ±Ù‡Ø§ØŒ ÙˆØ¹Ù„ÙŠÙ†Ø§ Ø£Ù† Ù†Ø­Ø±Øµ Ø¹Ù„Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ ÙÙŠÙ…Ø§ ÙŠÙ†ÙØ¹ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©." },
            { topic: "Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ", quran: "ï´¿ÙŠÙØ§ Ø£ÙÙŠÙÙ‘Ù‡ÙØ§ Ø§Ù„ÙÙ‘Ø°ÙÙŠÙ†Ù Ø¢Ù…ÙÙ†ÙÙˆØ§ Ø§Ø¬Ù’ØªÙÙ†ÙØ¨ÙÙˆØ§ ÙƒÙØ«ÙÙŠØ±Ù‹Ø§ Ù…ÙÙ‘Ù†Ù Ø§Ù„Ø¸ÙÙ‘Ù†ÙÙ‘ Ø¥ÙÙ†ÙÙ‘ Ø¨ÙØ¹Ù’Ø¶Ù Ø§Ù„Ø¸ÙÙ‘Ù†ÙÙ‘ Ø¥ÙØ«Ù’Ù…ÙŒ Û– ÙˆÙÙ„ÙØ§ ØªÙØ¬ÙØ³ÙÙ‘Ø³ÙÙˆØ§ï´¾ [Ø§Ù„Ø­Ø¬Ø±Ø§Øª: 12]", hadith: "Ù‚Ø§Ù„ Ø±Ø³ÙˆÙ„ Ø§Ù„Ù„Ù‡ ï·º: â€œØ§Ù„Ù…Ø³Ù„Ù… Ù…Ù† Ø³Ù„Ù… Ø§Ù„Ù…Ø³Ù„Ù…ÙˆÙ† Ù…Ù† Ù„Ø³Ø§Ù†Ù‡ ÙˆÙŠØ¯Ù‡â€", didYouKnow: "Ù‡Ù„ ØªØ¹Ù„Ù… Ø£Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ© ÙˆÙ…Ø®ØªÙ„ÙØ© Ù„ÙƒÙ„ Ø­Ø³Ø§Ø¨ Ù‡Ùˆ Ø®Ø· Ø§Ù„Ø¯ÙØ§Ø¹ Ø§Ù„Ø£ÙˆÙ„ Ø¶Ø¯ Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚ØŸ", wisdom: "Ø§Ù„ÙˆÙ‚Ø§ÙŠØ© ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù… Ø§Ù„Ø±Ù‚Ù…ÙŠ ØªØ¨Ø¯Ø£ Ø¨ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ©.", morningWord: "ÙÙŠ Ø¹Ø§Ù„Ù…Ù†Ø§ Ø§Ù„Ø±Ù‚Ù…ÙŠØŒ Ø£ØµØ¨Ø­ Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ Ø¶Ø±ÙˆØ±Ø© Ù„Ø­Ù…Ø§ÙŠØ© Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙ†Ø§ Ø§Ù„Ø´Ø®ØµÙŠØ©. ÙÙ„Ù†ÙƒÙ† ÙŠØ§ [Ø²Ù…Ù„Ø§Ø¡] Ù…ÙˆØ§Ø·Ù†ÙŠÙ† Ø±Ù‚Ù…ÙŠÙŠÙ† Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ†ØŒ Ù†Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø®ØµÙˆØµÙŠØªÙ†Ø§ ÙˆÙ„Ø§ Ù†Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©." },
            { topic: "Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø· Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ", quran: "ï´¿ÙˆÙØ£ÙÙ†Ù’ Ù„ÙÙŠÙ’Ø³Ù Ù„ÙÙ„Ù’Ø¥ÙÙ†Ù’Ø³ÙØ§Ù†Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ù…ÙØ§ Ø³ÙØ¹ÙÙ‰Ù°ØŒ ÙˆÙØ£ÙÙ†ÙÙ‘ Ø³ÙØ¹Ù’ÙŠÙÙ‡Ù Ø³ÙÙˆÙ’ÙÙ ÙŠÙØ±ÙÙ‰Ù°ï´¾ (Ø§Ù„Ù†Ø¬Ù…: 39-40).", hadith: "Ù‚Ø§Ù„ Ø±Ø³ÙˆÙ„ Ø§Ù„Ù„Ù‡ ØµÙ„Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡ ÙˆØ³Ù„Ù…: â€œÙ…ÙÙ† Ø³Ù„ÙÙƒ Ø·Ø±ÙŠÙ‚Ù‹Ø§ ÙŠÙ„ØªÙ…Ø³ ÙÙŠÙ‡ Ø¹Ù„Ù…Ù‹Ø§ØŒ Ø³Ù‡ÙÙ‘Ù„ Ø§Ù„Ù„Ù‡ Ù„Ù‡ Ø·Ø±ÙŠÙ‚Ù‹Ø§ Ø¥Ù„Ù‰ Ø§Ù„Ø¬Ù†ÙÙ‘Ø©...â€", didYouKnow: "Ù‡Ù„ ØªØ¹Ù„Ù… Ø£Ù† Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø°ÙŠÙ† ÙŠØ­Ø§ÙØ¸ÙˆÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ù…Ù†ØªØ¸Ù… ÙŠØ­Ù‚Ù‚ÙˆÙ† Ø¯Ø±Ø¬Ø§Øª Ø£ÙØ¶Ù„ Ù…Ù† ØºÙŠØ±Ù‡Ù…ØŸ", wisdom: "Ø§Ù„ÙˆÙ‚Øª ÙƒØ§Ù„Ø³ÙŠÙ Ø¥Ù† Ù„Ù… ØªÙ‚Ø·Ø¹Ù‡ Ù‚Ø·Ø¹Ùƒ.", morningWord: "ÙŠØ¹ØªØ¨Ø± Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø· Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ Ù‡Ùˆ Ø£Ø­Ø¯ Ø£ÙØ¶Ù„ Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ§Øª Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ© Ø§Ù„ØªÙŠ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªØ­Ù„Ù‰ Ø¨Ù‡Ø§ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨. ÙˆÙ‚Ø§Ù…Øª Ù…Ø¯Ø±Ø³ØªÙ†Ø§ Ø¨ÙˆØ¶Ø¹ Ù‚ÙˆØ§Ø¹Ø¯ ÙŠØ£ØªÙŠ ÙÙŠ Ù…Ù‚Ø¯Ù…ØªÙ‡Ø§ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ù… ÙÙŠ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ¹Ø¯Ù… Ø§Ù„ØºÙŠØ§Ø¨ Ø¥Ù„Ø§ Ù„Ù„Ø¶Ø±ÙˆØ±Ø© Ø§Ù„Ù‚ØµÙˆÙ‰." }
        ];

        // --- DOM ELEMENTS ---
        let currentMode = 'automatic'; // 'automatic' or 'manual'

        // General
        const broadcastTitle = document.getElementById('broadcast-title');
        const broadcastDateDisplay = document.getElementById('broadcast-date-display');
        const broadcastContent = document.getElementById('broadcast-content');
        const printButton = document.getElementById('print-button');
        const addNamesButton = document.getElementById('add-names-button');
        const supervisorInput = document.getElementById('supervisor');

        // Mode Switching
        const automaticModeBtn = document.getElementById('automatic-mode-btn');
        const manualModeBtn = document.getElementById('manual-mode-btn');
        const automaticControls = document.getElementById('automatic-controls');
        const manualControls = document.getElementById('manual-controls');
        
        // Automatic Mode
        const genderSelect = document.getElementById('gender');
        const topicSelect = document.getElementById('topic');
        const dateInput = document.getElementById('broadcast-date-input');

        // Manual Mode (Dynamic)
        const savedBroadcastsSelect = document.getElementById('saved-broadcasts-select');
        const loadManualBtn = document.getElementById('load-manual-btn');
        const deleteManualBtn = document.getElementById('delete-manual-btn');
        const saveManualBtn = document.getElementById('save-manual-btn');
        const manualBroadcastNameInput = document.getElementById('manual-broadcast-name');
        
        // Names Modal
        const namesModal = document.getElementById('names-modal');
        const closeModalButton = document.getElementById('close-modal-button');
        const saveNamesButton = document.getElementById('save-names-button');


        // --- STATE VARIABLES ---
        let studentNames = {}; // Object to hold dynamic names based on ID
        let currentManualSections = []; // Array to hold the dynamic sections

        // Initial default sections for manual mode
        const defaultManualSections = [
            { id: 'sec-intro', title: 'Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© ÙˆØ§Ù„Ø®Ø§ØªÙ…Ø©', content: '', isRemovable: false },
            { id: 'sec-quran', title: 'Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…', content: '', isRemovable: true },
            { id: 'sec-hadith', title: 'Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙŠÙ', content: '', isRemovable: true },
            { id: 'sec-wisdom', title: 'Ø­ÙƒÙ…Ø© Ø§Ù„ÙŠÙˆÙ…', content: '', isRemovable: true },
            { id: 'sec-word', title: 'ÙƒÙ„Ù…Ø© Ø§Ù„ØµØ¨Ø§Ø­', content: '', isRemovable: true }
        ];


        // --- AUTOMATIC MODE FUNCTIONS ---
        function populateSelectors() {
            broadcasts.forEach((broadcast, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = broadcast.topic;
                topicSelect.appendChild(option);
            });
        }
        
        function setInitialDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            dateInput.value = `${year}-${month}-${day}`;
        }

        function processGenderText(text, gender) {
            const replacements = {
                boys: { 'Ù…Ø¯ÙŠØ±': 'Ù…Ø¯ÙŠØ±Ù†Ø§ Ø§Ù„ÙØ§Ø¶Ù„', 'Ù…Ø¹Ù„Ù…ÙˆÙ†': 'Ø£Ø³Ø§ØªØ°ØªÙŠ Ø§Ù„Ø£ÙØ§Ø¶Ù„', 'Ø·Ù„Ø§Ø¨': 'Ø²Ù…Ù„Ø§Ø¦ÙŠ Ø§Ù„Ø£Ø¹Ø²Ø§Ø¡', 'Ø²Ù…Ù„Ø§Ø¡': 'Ø²Ù…Ù„Ø§Ø¦ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨', 'presenter': 'Ø§Ù„Ø·Ø§Ù„Ø¨' },
                girls: { 'Ù…Ø¯ÙŠØ±': 'Ù…Ø¯ÙŠØ±ØªÙ†Ø§ Ø§Ù„ÙØ§Ø¶Ù„Ø©', 'Ù…Ø¹Ù„Ù…ÙˆÙ†': 'Ù…Ø¹Ù„Ù…Ø§ØªÙŠ Ø§Ù„ÙØ§Ø¶Ù„Ø§Øª', 'Ø·Ù„Ø§Ø¨': 'Ø²Ù…ÙŠÙ„Ø§ØªÙŠ Ø§Ù„Ø¹Ø²ÙŠØ²Ø§Øª', 'Ø²Ù…Ù„Ø§Ø¡': 'Ø²Ù…ÙŠÙ„Ø§ØªÙŠ Ø§Ù„Ø·Ø§Ù„Ø¨Ø§Øª', 'presenter': 'Ø§Ù„Ø·Ø§Ù„Ø¨Ø©' }
            };
            const genderSpecifics = replacements[gender];
            let processedText = text;
            for (const key in genderSpecifics) {
                processedText = processedText.replace(new RegExp(`\\[${key}\\]`, 'g'), genderSpecifics[key]);
            }
            return processedText;
        }

        function displayAutomaticBroadcast() {
            const selectedIndex = parseInt(topicSelect.value);
            const selectedGender = genderSelect.value;
            
            const broadcastData = broadcasts[selectedIndex];
            const presenterWord = selectedGender === 'boys' ? 'Ø§Ù„Ø·Ø§Ù„Ø¨' : 'Ø§Ù„Ø·Ø§Ù„Ø¨Ø©';
            const placeholder = '....................................';

            if (broadcastData) {
                broadcastTitle.textContent = `Ø¥Ø°Ø§Ø¹Ø© Ø¹Ù†: ${broadcastData.topic}`;
                
                const dateValue = dateInput.value ? new Date(dateInput.value) : new Date();
                const userTimezoneOffset = dateValue.getTimezoneOffset() * 60000;
                const adjustedDate = new Date(dateValue.getTime() + userTimezoneOffset);

                const hijriDate = new Intl.DateTimeFormat('ar-SA-u-ca-islamic-umalqura', {
                    weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
                }).format(adjustedDate);
                broadcastDateDisplay.textContent = hijriDate;

                const intro = `Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…ØŒ ÙˆØ§Ù„ØµÙ„Ø§Ø© ÙˆØ§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„Ù‰ Ø£Ø´Ø±Ù Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡ ÙˆØ§Ù„Ù…Ø±Ø³Ù„ÙŠÙ† Ø³ÙŠØ¯Ù†Ø§ Ù…Ø­Ù…Ø¯ ØµÙ„Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡ ÙˆØ³Ù„Ù… Ø£Ù…Ø§ Ø¨Ø¹Ø¯ØŒ [Ù…Ø¯ÙŠØ±]ØŒ [Ù…Ø¹Ù„Ù…ÙˆÙ†]ØŒ [Ø·Ù„Ø§Ø¨]ØŒ ÙŠØ³Ø±Ù†Ø§ Ø£Ù† Ù†Ù‚Ø¯Ù… Ù„ÙƒÙ… Ø¥Ø°Ø§Ø¹ØªÙ†Ø§ Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… (${hijriDate}) ÙˆÙ‡ÙŠ Ø¨Ø¹Ù†ÙˆØ§Ù† (${broadcastData.topic}). ÙˆØ®ÙŠØ± Ù…Ø§ Ù†Ø¨Ø¯Ø£ Ø¨Ù‡ ÙÙ‚Ø±Ø§ØªÙ†Ø§ Ù‡Ùˆ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… Ù…Ø¹ ${presenterWord} <span class="student-name">${studentNames['quran'] || placeholder}</span>ØŒ Ø«Ù… Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙŠÙ Ù…Ø¹ ${presenterWord} <span class="student-name">${studentNames['hadith'] || placeholder}</span>ØŒ Ø«Ù… ÙÙ‚Ø±Ø© Ù‡Ù„ ØªØ¹Ù„Ù… Ù…Ø¹ ${presenterWord} <span class="student-name">${studentNames['didYouKnow'] || placeholder}</span>ØŒ Ø«Ù… Ø­ÙƒÙ…Ø© Ø§Ù„ÙŠÙˆÙ… Ù…Ø¹ ${presenterWord} <span class="student-name">${studentNames['wisdom'] || placeholder}</span>ØŒ ÙˆØ£Ø®ÙŠØ±Ø§Ù‹ ÙƒÙ„Ù…Ø© Ø§Ù„ØµØ¨Ø§Ø­ Ù…Ø¹ ${presenterWord} <span class="student-name">${studentNames['morningWord'] || placeholder}</span>.`;
                const conclusion = `Ø¥Ù„Ù‰ Ù‡Ù†Ø§ Ù†ÙƒÙˆÙ† ÙˆØµÙ„Ù†Ø§ Ø¥Ù„Ù‰ Ù†Ù‡Ø§ÙŠØ© Ø¨Ø±Ù†Ø§Ù…Ø¬Ù†Ø§ Ø§Ù„Ø¥Ø°Ø§Ø¹ÙŠØŒ ØªØ­Ø¯Ø«Ù†Ø§ ÙÙŠÙ‡ Ø¹Ù† ${broadcastData.topic}ØŒ Ø³Ø§Ø¦Ù„ÙŠÙ† Ø§Ù„Ù„Ù‡ Ù„Ù†Ø§ ÙˆÙ„ÙƒÙ… Ø§Ù„ØªÙˆÙÙŠÙ‚ ÙˆØ§Ù„Ø³Ø¯Ø§Ø¯. ÙˆØ§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡ØŒ ÙƒØ§Ù† Ù…Ø¹ÙƒÙ… ${presenterWord}: <span class="student-name">${studentNames['presenter'] || placeholder}</span>`;
                
                const paragraphs = [
                    { title: 'Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© ÙˆØ§Ù„Ø®Ø§ØªÙ…Ø©', content: `<p>${processGenderText(intro, selectedGender)}</p><p class="mt-4">${processGenderText(conclusion, selectedGender)}</p>` },
                    { title: 'ÙÙ‚Ø±Ø© Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…', content: `<p>${broadcastData.quran}</p>` },
                    { title: 'ÙÙ‚Ø±Ø© Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙŠÙ', content: `<p>${broadcastData.hadith}</p>` },
                    { title: 'ÙÙ‚Ø±Ø© Ù‡Ù„ ØªØ¹Ù„Ù…', content: `<p>${broadcastData.didYouKnow}</p>` },
                    { title: 'ÙÙ‚Ø±Ø© Ø­ÙƒÙ…Ø© Ø§Ù„ÙŠÙˆÙ…', content: `<p>${broadcastData.wisdom}</p>` },
                    { title: 'ÙÙ‚Ø±Ø© ÙƒÙ„Ù…Ø© Ø§Ù„ØµØ¨Ø§Ø­', content: `<p>${processGenderText(broadcastData.morningWord, selectedGender)}</p>` }
                ];
                
                renderBroadcastContent(paragraphs);
            } else {
                broadcastContent.innerHTML = '<p class="text-red-500">Ø¹Ø°Ø±Ù‹Ø§ØŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø°Ø§Ø¹Ø©.</p>';
            }
        }

        // --- MANUAL MODE (DYNAMIC) FUNCTIONS ---

        function initManualEditor() {
            if (currentManualSections.length === 0) {
                currentManualSections = JSON.parse(JSON.stringify(defaultManualSections));
            }
            renderManualEditor();
        }

        function renderManualEditor() {
            const container = document.getElementById('manual-sections-container');
            container.innerHTML = '';

            currentManualSections.forEach((section, index) => {
                const div = document.createElement('div');
                div.className = 'section-card';
                
                // Controls
                const isFirst = index === 0;
                const isLast = index === currentManualSections.length - 1;
                
                let controlsHtml = `<div class="section-controls">`;
                if (!isFirst) controlsHtml += `<button onclick="moveSection(${index}, -1)" class="control-btn btn-up" title="ØªØ­Ø±ÙŠÙƒ Ù„Ø£Ø¹Ù„Ù‰">â¬†</button>`;
                if (!isLast) controlsHtml += `<button onclick="moveSection(${index}, 1)" class="control-btn btn-down" title="ØªØ­Ø±ÙŠÙƒ Ù„Ø£Ø³ÙÙ„">â¬‡</button>`;
                if (section.isRemovable !== false) controlsHtml += `<button onclick="deleteSection(${index})" class="control-btn btn-delete" title="Ø­Ø°Ù Ø§Ù„ÙÙ‚Ø±Ø©">ğŸ—‘ï¸</button>`;
                controlsHtml += `</div>`;

                div.innerHTML = `
                    ${controlsHtml}
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙ‚Ø±Ø©</label>
                        <input type="text" value="${section.title}" onchange="updateSection(${index}, 'title', this.value)" class="section-title-input" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙ‚Ø±Ø©">
                    </div>
                    <div class="mt-2">
                        <label class="block text-xs text-gray-500 mb-1">Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙÙ‚Ø±Ø©</label>
                        <textarea rows="3" onchange="updateSection(${index}, 'content', this.value)" class="block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 placeholder-gray-400" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‡Ù†Ø§...">${section.content}</textarea>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // Exposed globally for onclick usage
        window.updateSection = function(index, field, value) {
            currentManualSections[index][field] = value;
            // Optionally auto-update preview
            // displayManualBroadcast({ type: 'dynamic', sections: currentManualSections });
        };

        window.moveSection = function(index, direction) {
            const newIndex = index + direction;
            if (newIndex >= 0 && newIndex < currentManualSections.length) {
                const temp = currentManualSections[index];
                currentManualSections[index] = currentManualSections[newIndex];
                currentManualSections[newIndex] = temp;
                renderManualEditor();
            }
        };

        window.deleteSection = function(index) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ÙÙ‚Ø±Ø©ØŸ')) {
                currentManualSections.splice(index, 1);
                renderManualEditor();
            }
        };

        function addNewSection() {
            const newId = 'sec-' + Date.now();
            currentManualSections.push({
                id: newId,
                title: 'ÙÙ‚Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©',
                content: '',
                isRemovable: true
            });
            renderManualEditor();
            setTimeout(() => {
                const container = document.getElementById('manual-sections-container');
                container.lastElementChild.scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        // --- SAVING & LOADING (MANUAL) ---

        function getSavedBroadcasts() {
            return JSON.parse(localStorage.getItem('custom_broadcasts')) || {};
        }

        function populateSavedBroadcasts() {
            const saved = getSavedBroadcasts();
            savedBroadcastsSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø¥Ø°Ø§Ø¹Ø© Ù…Ø­ÙÙˆØ¸Ø© --</option>';
            for (const name in saved) {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                savedBroadcastsSelect.appendChild(option);
            }
        }

        function saveManualBroadcast() {
            const name = manualBroadcastNameInput.value.trim();
            if (!name) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ù„Ù„Ø¥Ø°Ø§Ø¹Ø© Ù„Ø­ÙØ¸Ù‡Ø§.');
                return;
            }

            const manualData = {
                name: name,
                type: 'dynamic', 
                sections: currentManualSections
            };

            let saved = getSavedBroadcasts();
            saved[name] = manualData;
            localStorage.setItem('custom_broadcasts', JSON.stringify(saved));
            
            populateSavedBroadcasts();
            savedBroadcastsSelect.value = name;
            displayManualBroadcast(manualData);
        }

        function loadManualBroadcast() {
            const name = savedBroadcastsSelect.value;
            if (!name) return;

            const saved = getSavedBroadcasts();
            const data = saved[name];

            if (data) {
                manualBroadcastNameInput.value = data.name || '';
                
                if (data.type === 'dynamic' && data.sections) {
                    currentManualSections = data.sections;
                } else {
                    // Backward compatibility
                    currentManualSections = [
                        { id: 'sec-intro', title: 'Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© ÙˆØ§Ù„Ø®Ø§ØªÙ…Ø©', content: data.introConclusion || '', isRemovable: false },
                        { id: 'sec-quran', title: 'Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…', content: data.quran || '', isRemovable: true },
                        { id: 'sec-hadith', title: 'Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙŠÙ', content: data.hadith || '', isRemovable: true },
                        { id: 'sec-didyouknow', title: 'ÙÙ‚Ø±Ø© Ù‡Ù„ ØªØ¹Ù„Ù…', content: data.didYouKnow || '', isRemovable: true },
                        { id: 'sec-wisdom', title: 'ÙÙ‚Ø±Ø© Ø­ÙƒÙ…Ø© Ø§Ù„ÙŠÙˆÙ…', content: data.wisdom || '', isRemovable: true },
                        { id: 'sec-word', title: 'ÙÙ‚Ø±Ø© ÙƒÙ„Ù…Ø© Ø§Ù„ØµØ¨Ø§Ø­', content: data.morningWord || '', isRemovable: true }
                    ];
                }
                renderManualEditor();
                displayManualBroadcast(data);
            }
        }

        function deleteManualBroadcast() {
            const name = savedBroadcastsSelect.value;
            if (!name) return;
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¥Ø°Ø§Ø¹Ø© "${name}"ØŸ`)) {
                let saved = getSavedBroadcasts();
                delete saved[name];
                localStorage.setItem('custom_broadcasts', JSON.stringify(saved));
                
                manualBroadcastNameInput.value = '';
                currentManualSections = JSON.parse(JSON.stringify(defaultManualSections));
                renderManualEditor();
                broadcastTitle.textContent = 'Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø°Ø§Ø¹Ø© ÙŠØ¯ÙˆÙŠØ©';
                broadcastContent.innerHTML = '<p class="text-center text-gray-500">Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø£Ø¹Ù„Ø§Ù‡.</p>';
                
                populateSavedBroadcasts();
            }
        }

        function displayManualBroadcast(data) {
            let sectionsToRender = [];
            if (data.type === 'dynamic') {
                sectionsToRender = data.sections;
            } else {
                 sectionsToRender = currentManualSections; 
            }

            broadcastTitle.textContent = data.name || manualBroadcastNameInput.value || 'Ø¥Ø°Ø§Ø¹Ø© ÙŠØ¯ÙˆÙŠØ©';
            
            const dateValue = dateInput.value ? new Date(dateInput.value) : new Date();
            const hijriDate = new Intl.DateTimeFormat('ar-SA-u-ca-islamic-umalqura', {
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
            }).format(dateValue);
            broadcastDateDisplay.textContent = hijriDate;

            const contentHTML = sectionsToRender.map((section, index) => {
                if (!section.content.trim()) return '';
                const colors = ['#264653', '#2a9d8e', '#347f98', '#af9d72', '#d48647', '#cc6146'];
                return `
                    <div class="broadcast-card glass-container" style="border-right-color: ${colors[index % colors.length]};">
                        <h3>${section.title}</h3>
                        <p>${section.content.replace(/\n/g, '<br>')}</p>
                    </div>`;
            }).join('');

            broadcastContent.innerHTML = contentHTML || '<p class="text-center text-gray-500">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰ Ù„Ø¹Ø±Ø¶Ù‡ Ø­Ø§Ù„ÙŠÙ‹Ø§.</p>';
        }

        // --- SHARED DISPLAY ---
        function renderBroadcastContent(paragraphs) {
            const colors = ['#264653', '#2a9d8e', '#347f98', '#af9d72', '#d48647', '#cc6146'];
            let contentHTML = '';

            paragraphs.forEach((p, index) => {
                if (p.content && p.content.replace(/<p>|<\/p>|<br>/g, '').trim() !== '') {
                    contentHTML += `
                        <div class="broadcast-card glass-container" style="border-right-color: ${colors[index % colors.length]};">
                            <h3>${p.title}</h3>
                            ${p.content}
                        </div>`;
                }
            });

            broadcastContent.innerHTML = contentHTML || '<p class="text-center text-gray-500">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰ Ù„Ø¹Ø±Ø¶Ù‡ Ø­Ø§Ù„ÙŠÙ‹Ø§.</p>';
        }

        // --- NAMES MODAL LOGIC (DYNAMIC) ---
        
        function openModal() {
            const container = document.getElementById('dynamic-names-container');
            container.innerHTML = ''; 

            // Presenter is always needed
            addNameField(container, 'presenter', 'Ù…Ù‚Ø¯Ù… Ø§Ù„Ø¥Ø°Ø§Ø¹Ø©');

            if (currentMode === 'automatic') {
                addNameField(container, 'quran', 'ÙÙ‚Ø±Ø© Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…');
                addNameField(container, 'hadith', 'ÙÙ‚Ø±Ø© Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙŠÙ');
                addNameField(container, 'morningWord', 'ÙÙ‚Ø±Ø© ÙƒÙ„Ù…Ø© Ø§Ù„ØµØ¨Ø§Ø­');
                addNameField(container, 'didYouKnow', 'ÙÙ‚Ø±Ø© Ù‡Ù„ ØªØ¹Ù„Ù…');
                addNameField(container, 'wisdom', 'ÙÙ‚Ø±Ø© Ø­ÙƒÙ…Ø© Ø§Ù„ÙŠÙˆÙ…');
            } else {
                // Manual Mode: Loop through sections
                currentManualSections.forEach(section => {
                    // Skip Intro/Conclusion for specific assignment usually
                    if (!section.title.includes('Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©')) {
                         addNameField(container, section.id, `ÙÙ‚Ø±Ø©: ${section.title}`);
                    }
                });
            }

            namesModal.classList.remove('opacity-0', 'pointer-events-none');
            namesModal.querySelector('div').classList.remove('scale-95');
        }

        function addNameField(container, id, labelText) {
            const div = document.createElement('div');
            const val = studentNames[id] || '';
            div.innerHTML = `
                <label class="block text-sm font-medium text-gray-700">${labelText}</label>
                <input type="text" data-id="${id}" value="${val}" class="name-input mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
            `;
            container.appendChild(div);
        }

        function closeModal() {
            namesModal.classList.add('opacity-0', 'pointer-events-none');
            namesModal.querySelector('div').classList.add('scale-95');
        }

        // --- PRINT LOGIC ---
        function handlePrint() {
            const supervisorName = supervisorInput.value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            const printWindow = window.open('', '_blank');
            if (!printWindow) { alert("ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©."); return; }
            
            let page1Content = '', page2Content = '';
            const colors = ['#264653', '#2a9d8e', '#347f98', '#af9d72', '#d48647', '#cc6146'];

            if(currentMode === 'automatic') {
                const selectedIndex = parseInt(topicSelect.value);
                const selectedGender = genderSelect.value;
                const broadcastData = broadcasts[selectedIndex];
                const presenterWord = selectedGender === 'boys' ? 'Ø§Ù„Ø·Ø§Ù„Ø¨' : 'Ø§Ù„Ø·Ø§Ù„Ø¨Ø©';
                const placeholder = '....................................';
                
                const intro = `Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…ØŒ ÙˆØ§Ù„ØµÙ„Ø§Ø© ÙˆØ§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„Ù‰ Ø£Ø´Ø±Ù Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡ ÙˆØ§Ù„Ù…Ø±Ø³Ù„ÙŠÙ† Ø³ÙŠØ¯Ù†Ø§ Ù…Ø­Ù…Ø¯ ØµÙ„Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡ ÙˆØ³Ù„Ù… Ø£Ù…Ø§ Ø¨Ø¹Ø¯ØŒ [Ù…Ø¯ÙŠØ±]ØŒ [Ù…Ø¹Ù„Ù…ÙˆÙ†]ØŒ [Ø·Ù„Ø§Ø¨]ØŒ ÙŠØ³Ø±Ù†Ø§ Ø£Ù† Ù†Ù‚Ø¯Ù… Ù„ÙƒÙ… Ø¥Ø°Ø§Ø¹ØªÙ†Ø§ Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… (${broadcastDateDisplay.textContent}) ÙˆÙ‡ÙŠ Ø¨Ø¹Ù†ÙˆØ§Ù† (${broadcastData.topic}). ÙˆØ®ÙŠØ± Ù…Ø§ Ù†Ø¨Ø¯Ø£ Ø¨Ù‡ ÙÙ‚Ø±Ø§ØªÙ†Ø§ Ù‡Ùˆ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… Ù…Ø¹ ${presenterWord} <span class="student-name">${studentNames.quran || placeholder}</span>ØŒ Ø«Ù… Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙŠÙ Ù…Ø¹ ${presenterWord} <span class="student-name">${studentNames.hadith || placeholder}</span>ØŒ Ø«Ù… ÙÙ‚Ø±Ø© Ù‡Ù„ ØªØ¹Ù„Ù… Ù…Ø¹ ${presenterWord} <span class="student-name">${studentNames.didYouKnow || placeholder}</span>ØŒ Ø«Ù… Ø­ÙƒÙ…Ø© Ø§Ù„ÙŠÙˆÙ… Ù…Ø¹ ${presenterWord} <span class="student-name">${studentNames.wisdom || placeholder}</span>ØŒ ÙˆØ£Ø®ÙŠØ±Ø§Ù‹ ÙƒÙ„Ù…Ø© Ø§Ù„ØµØ¨Ø§Ø­ Ù…Ø¹ ${presenterWord} <span class="student-name">${studentNames.morningWord || placeholder}</span>.`;
                const conclusion = `Ø¥Ù„Ù‰ Ù‡Ù†Ø§ Ù†ÙƒÙˆÙ† ÙˆØµÙ„Ù†Ø§ Ø¥Ù„Ù‰ Ù†Ù‡Ø§ÙŠØ© Ø¨Ø±Ù†Ø§Ù…Ø¬Ù†Ø§ Ø§Ù„Ø¥Ø°Ø§Ø¹ÙŠØŒ ØªØ­Ø¯Ø«Ù†Ø§ ÙÙŠÙ‡ Ø¹Ù† ${broadcastData.topic}ØŒ Ø³Ø§Ø¦Ù„ÙŠÙ† Ø§Ù„Ù„Ù‡ Ù„Ù†Ø§ ÙˆÙ„ÙƒÙ… Ø§Ù„ØªÙˆÙÙŠÙ‚ ÙˆØ§Ù„Ø³Ø¯Ø§Ø¯. ÙˆØ§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡ØŒ ÙƒØ§Ù† Ù…Ø¹ÙƒÙ… ${presenterWord}: <span class="student-name">${studentNames.presenter || placeholder}</span>`;

                page1Content = `<div class="print-item broadcast-card" style="border-right: 8px solid ${colors[0]}; padding-right: 2.5rem;"><h3>Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© ÙˆØ§Ù„Ø®Ø§ØªÙ…Ø©</h3><p>${processGenderText(intro, selectedGender)}</p><p class="mt-4">${processGenderText(conclusion, selectedGender)}</p><p class="supervisor">Ø¥Ø´Ø±Ø§Ù Ø§Ù„Ø£Ø³ØªØ§Ø°/Ø©: ${supervisorName}</p></div>`;
                
                const page2Paragraphs = [
                    { title: 'ÙÙ‚Ø±Ø© Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…', content: broadcastData.quran },
                    { title: 'ÙÙ‚Ø±Ø© Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙŠÙ', content: broadcastData.hadith },
                    { title: 'ÙÙ‚Ø±Ø© Ù‡Ù„ ØªØ¹Ù„Ù…', content: broadcastData.didYouKnow },
                    { title: 'ÙÙ‚Ø±Ø© Ø­ÙƒÙ…Ø© Ø§Ù„ÙŠÙˆÙ…', content: broadcastData.wisdom },
                    { title: 'ÙÙ‚Ø±Ø© ÙƒÙ„Ù…Ø© Ø§Ù„ØµØ¨Ø§Ø­', content: processGenderText(broadcastData.morningWord, selectedGender) }
                ];
                page2Content = page2Paragraphs.map((item, index) => `<div class="print-item broadcast-card" style="border-right: 8px solid ${colors[(index + 1) % colors.length]}; padding-right: 2.5rem;"><h3>${item.title}</h3><p>${item.content}</p></div>`).join('');

            } else { 
                // MANUAL MODE (DYNAMIC) PRINT LOGIC
                let page1HTML = '';
                let page2HTML = '';

                currentManualSections.forEach((section, index) => {
                    // Add student name if exists for this section ID
                    const sName = studentNames[section.id] ? `<br><span class="student-name text-sm">ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø·Ø§Ù„Ø¨/Ù€Ø©: ${studentNames[section.id]}</span>` : '';
                    const cardHTML = `
                        <div class="print-item broadcast-card" style="border-right: 8px solid ${colors[index % colors.length]}; padding-right: 2.5rem;">
                            <h3>${section.title}</h3>
                            <p>${section.content.replace(/\n/g, '<br>')}</p>
                            ${sName}
                            ${index === 0 ? `<p class="supervisor">Ø¥Ø´Ø±Ø§Ù Ø§Ù„Ø£Ø³ØªØ§Ø°/Ø©: ${supervisorName}</p>` : ''}
                        </div>
                    `;

                    if (index === 0) {
                        page1HTML += cardHTML; // First item (Intro) on page 1
                    } else {
                        page2HTML += cardHTML; // Rest on page 2
                    }
                });
                page1Content = page1HTML;
                page2Content = page2HTML;
            }

            const printTemplate = `
                <html>
                <head>
                    <title>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥Ø°Ø§Ø¹Ø© - ${broadcastTitle.textContent}</title>
                    <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
                    <style>
                        @page { size: A4; margin: 0; }
                        body { font-family: 'Tajawal', sans-serif; direction: rtl; margin: 0; }
                        .page-wrapper { page-break-after: always; } .page-wrapper:last-child { page-break-after: auto; }
                        .page-container { display: flex; flex-direction: column; min-height: 100vh; }
                        .print-header { background-color: #003a46 !important; color: white !important; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; -webkit-print-color-adjust: exact; color-adjust: exact; }
                        .print-header h2 { margin: 0; padding: 0; font-size: 1.4rem; font-weight: normal; }
                        .header-info { font-size: 1rem; color: #eee !important; }
                        .gradient-line { height: 5px; background: linear-gradient(to left, #34ad82, #2490ac) !important; -webkit-print-color-adjust: exact; color-adjust: exact; }
                        .print-content { padding: 1.5rem 2rem; flex-grow: 1; }
                        .print-item { margin-bottom: 1.5rem; padding: 1.5rem; page-break-inside: avoid; border-radius: 0.75rem; background: rgba(255, 255, 255, 0.85) !important; }
                        .print-item p { font-size: 1.1rem; line-height: 1.8; color: #1f2937; margin-bottom: 0.2rem; }
                        .print-item h3 { font-size: 1.25rem; font-weight: bold; margin-bottom: 0.5rem; color: #1e3a8a !important; border-bottom: none; padding-bottom: 0; }
                        .supervisor { font-size: 1rem; font-weight: bold; margin-top: 1.5rem; color: #003a46 !important; }
                        .student-name { color: #1e3a8a !important; font-weight: bold; }
                        .print-footer { height: 20px; background: linear-gradient(to left, #34ad82, #2490ac) !important; width: 100%; margin-top: auto; -webkit-print-color-adjust: exact; color-adjust: exact; }
                    </style>
                </head>
                <body>
                    <div class="page-wrapper"><div class="page-container">
                        <div class="print-header"><h2>${broadcastTitle.textContent} - Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© ÙˆØ§Ù„Ø®Ø§ØªÙ…Ø©</h2><div class="header-info">${broadcastDateDisplay.textContent}</div></div>
                        <div class="gradient-line"></div><div class="print-content">${page1Content}</div><div class="print-footer"></div>
                    </div></div>
                    <div class="page-wrapper"><div class="page-container">
                        <div class="print-header"><h2>${broadcastTitle.textContent} - Ø§Ù„ÙÙ‚Ø±Ø§Øª</h2><div class="header-info">${broadcastDateDisplay.textContent}</div></div>
                        <div class="gradient-line"></div><div class="print-content">${page2Content}</div><div class="print-footer"></div>
                    </div></div>
                </body>
                </html>
            `;
            
            printWindow.document.write(printTemplate);
            printWindow.document.close();
            setTimeout(() => { printWindow.print(); printWindow.close(); }, 250);
        }

        // --- EVENT LISTENERS ---
        document.addEventListener('DOMContentLoaded', () => {
            const pledgeModal = document.getElementById('pledge-modal');
            const agreeButton = document.getElementById('agree-button');
            const mainApp = document.getElementById('main-app');

            agreeButton.addEventListener('click', () => {
                pledgeModal.classList.add('hidden');
                mainApp.classList.remove('hidden');
            });

            populateSelectors();
            setInitialDate();
            displayAutomaticBroadcast();
            populateSavedBroadcasts();

            // Additional listener for the Add Section button
            document.getElementById('add-new-section-btn').addEventListener('click', addNewSection);
        });

        genderSelect.addEventListener('change', displayAutomaticBroadcast);
        topicSelect.addEventListener('change', displayAutomaticBroadcast);
        
        saveManualBtn.addEventListener('click', saveManualBroadcast);
        loadManualBtn.addEventListener('click', loadManualBroadcast);
        deleteManualBtn.addEventListener('click', deleteManualBroadcast);

        dateInput.addEventListener('change', () => {
            if (currentMode === 'automatic') displayAutomaticBroadcast();
            else displayManualBroadcast({ type: 'dynamic', sections: currentManualSections });
        });

        printButton.addEventListener('click', handlePrint);
        addNamesButton.addEventListener('click', openModal);
        closeModalButton.addEventListener('click', closeModal);
        
        saveNamesButton.addEventListener('click', () => {
            const inputs = document.querySelectorAll('.name-input');
            inputs.forEach(input => {
                studentNames[input.dataset.id] = input.value;
            });
            closeModal();
            if (currentMode === 'automatic') displayAutomaticBroadcast();
        });
        
        automaticModeBtn.addEventListener('click', () => {
            currentMode = 'automatic';
            manualControls.classList.add('hidden');
            automaticControls.classList.remove('hidden');
            manualModeBtn.classList.remove('active');
            automaticModeBtn.classList.add('active');
            displayAutomaticBroadcast();
        });

        manualModeBtn.addEventListener('click', () => {
            currentMode = 'manual';
            automaticControls.classList.add('hidden');
            manualControls.classList.remove('hidden');
            automaticModeBtn.classList.remove('active');
            manualModeBtn.classList.add('active');
            
            initManualEditor();
            if (manualBroadcastNameInput.value) {
                displayManualBroadcast({ type: 'dynamic', sections: currentManualSections });
            } else {
                broadcastTitle.textContent = 'Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø°Ø§Ø¹Ø© ÙŠØ¯ÙˆÙŠØ©';
                broadcastContent.innerHTML = '<p class="text-center text-gray-500">Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø£Ø¹Ù„Ø§Ù‡ Ø£Ùˆ Ù‚Ù… Ø¨ØªØ­Ù…ÙŠÙ„ Ø¥Ø°Ø§Ø¹Ø© Ù…Ø­ÙÙˆØ¸Ø©.</p>';
            }
        });

    </script>
</body>
</html>
