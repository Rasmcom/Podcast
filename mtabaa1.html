<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>متابعة الإذاعة المدرسية - عام 1447هـ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f7fafc;
        }
        @media print {
            body > *:not(#print-view) {
                display: none;
            }
        }
        .custom-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: left 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Main Content -->
    <div class="container mx-auto p-4" id="main-content">
        <!-- Header -->
        <header class="bg-white rounded-lg shadow-md">
            <div style="background-color: #003a46;" class="p-4 text-white text-center rounded-t-lg">
                <div class="flex justify-between items-center mb-4">
                    <div></div>
                    <h1 class="text-3xl font-bold">متابعة الإذاعة المدرسية (1447هـ)</h1>
                    <img src="https://j.top4top.io/p_3516qltr40.png" alt="شعار الوزارة" class="h-16" onerror="this.onerror=null;this.src='https://placehold.co/64x64/eee/ccc?text=Logo';">
                </div>
                <div class="flex justify-center gap-6">
                    <input type="text" id="edu-admin" placeholder="ادخل اسم الإدارة التعليمية" class="w-1/3 bg-transparent border-b-2 border-gray-400 text-white text-center placeholder-gray-300 focus:outline-none focus:border-green-400 transition">
                    <input type="text" id="school-name" placeholder="ادخل اسم المدرسة" class="w-1/3 bg-transparent border-b-2 border-gray-400 text-white text-center placeholder-gray-300 focus:outline-none focus:border-green-400 transition">
                </div>
            </div>
            <div class="h-2 bg-gradient-to-l from-green-500 via-teal-500 to-blue-500" style="--tw-gradient-from: #34ad82; --tw-gradient-to: #2490ac;"></div>
        </header>

        <main class="bg-white p-6 rounded-lg shadow-md mt-6">
            <!-- Controls -->
            <div class="mb-6 border-b pb-4">
                <h3 class="text-lg font-semibold text-gray-700 mb-3 text-center">إعدادات المنطقة</h3>
                <div class="flex justify-center gap-x-8 text-gray-700">
                    <label class="flex items-center cursor-pointer hover:bg-gray-50 p-2 rounded transition">
                        <input type="radio" name="region" value="default" checked class="form-radio h-5 w-5 text-blue-600">
                        <span class="mr-2 font-bold">باقي المناطق</span>
                    </label>
                    <label class="flex items-center cursor-pointer hover:bg-gray-50 p-2 rounded transition">
                        <input type="radio" name="region" value="western" class="form-radio h-5 w-5 text-blue-600">
                        <span class="mr-2 font-bold">المنطقة الغربية (مكة/المدينة/جدة)</span>
                    </label>
                </div>
            </div>

            <!-- Selection Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <!-- Semester Selector -->
                <div>
                    <label for="semester-selector" class="block text-sm font-medium text-gray-700 mb-1">اختر الفصل الدراسي:</label>
                    <select id="semester-selector" class="custom-select block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50 bg-gray-50 border-2 py-2">
                        <option value="1">الفصل الدراسي الأول</option>
                        <option value="2">الفصل الدراسي الثاني</option>
                    </select>
                </div>

                <!-- Week Selector -->
                <div>
                    <label for="week-selector" class="block text-sm font-medium text-gray-700 mb-1">اختر الأسبوع:</label>
                    <select id="week-selector" class="custom-select block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50 bg-gray-50 border-2 py-2">
                        <option value="">الرجاء اختيار أسبوع</option>
                    </select>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex justify-end items-center gap-3 mb-4">
                <div id="save-status" class="flex items-center gap-2 text-green-600 opacity-0 transition-opacity duration-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                    <span>تم الحفظ</span>
                </div>
                 <button id="clear-button" title="مسح البيانات المحفوظة" class="bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600 transition flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg>
                    <span>مسح الكل</span>
                </button>
                <button id="print-button" title="طباعة الفصل المحدد" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 4v3H4a2 2 0 00-2 2v6a2 2 0 002 2h12a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z" clip-rule="evenodd" /></svg>
                    <span>طباعة (صفحتين)</span>
                </button>
            </div>
            
            <div class="overflow-x-auto">
                <h2 id="table-title" class="text-xl font-semibold text-center mb-4 text-gray-800"></h2>
                <div id="table-container"></div>
            </div>
        </main>

        <footer class="mt-6 rounded-lg shadow-md bg-white">
            <div class="h-10 bg-gradient-to-l from-green-500 via-teal-500 to-blue-500 rounded-t-lg" style="--tw-gradient-from: #34ad82; --tw-gradient-to: #2490ac;"></div>
            <div class="p-4 flex flex-col items-center gap-6">
                <!-- Signatures -->
                <div class="flex w-full justify-around">
                     <input type="text" id="supervisor-name" placeholder="اسم مشرف الإذاعة" class="text-center block w-48 bg-transparent border-b border-gray-300 focus:outline-none focus:border-blue-500">
                     <input type="text" id="manager-name" placeholder="اسم مدير المدرسة" class="text-center block w-48 bg-transparent border-b border-gray-300 focus:outline-none focus:border-blue-500">
                </div>
                 <div class="flex items-center gap-4 text-gray-600 text-sm pt-4 border-t border-gray-200 w-full justify-center">
                    <a href="https://www.rasmcom.com" target="_blank" rel="noopener noreferrer">
                        <img src="https://e.top4top.io/p_3463x5tj40.png" alt="شعار رسم" class="h-12 w-auto" onerror="this.onerror=null;this.style.display='none'">
                    </a>
                    <span>جميع الحقوق محفوظة لرسم للتصميم والخدمات التعليمية 2025</span>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- Confirm Modal -->
    <div id="confirm-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl text-center">
            <p id="confirm-message" class="mb-4 text-lg">هل أنت متأكد؟</p>
            <button id="confirm-yes" class="bg-red-600 text-white px-6 py-2 rounded-md hover:bg-red-700 mx-2">نعم</button>
            <button id="confirm-no" class="bg-gray-300 text-black px-6 py-2 rounded-md hover:bg-gray-400 mx-2">إلغاء</button>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const weekSelector = document.getElementById('week-selector');
            const semesterSelector = document.getElementById('semester-selector');
            const tableContainer = document.getElementById('table-container');
            const tableTitle = document.getElementById('table-title');
            const printButton = document.getElementById('print-button');
            const clearButton = document.getElementById('clear-button');
            const saveStatus = document.getElementById('save-status');
            const confirmModal = document.getElementById('confirm-modal');
            const confirmMessage = document.getElementById('confirm-message');
            const confirmYes = document.getElementById('confirm-yes');
            const confirmNo = document.getElementById('confirm-no');
            const regionRadios = document.querySelectorAll('input[name="region"]');
            const dayNames = ['الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس'];
            let saveTimeout;
            let confirmCallback = null;

            // --- DATA HANDLING ---
            function saveData() {
                const weekKey = weekSelector.value;
                if (!weekKey) return;

                const tableRows = tableContainer.querySelectorAll('tbody tr');
                const weekData = Array.from(tableRows).map(row => {
                    if (row.classList.contains('holiday-row')) {
                        return { holiday: true, text: row.querySelector('td').textContent };
                    }
                    return {
                        teacher: row.querySelector('.teacher-input').value,
                        status: row.querySelector('.status-select').value,
                        signature: row.querySelector('.signature-input').value,
                    };
                });
                
                const generalData = {
                    eduAdmin: document.getElementById('edu-admin').value,
                    schoolName: document.getElementById('school-name').value,
                    supervisorName: document.getElementById('supervisor-name').value,
                    managerName: document.getElementById('manager-name').value,
                    selectedRegion: document.querySelector('input[name="region"]:checked').value
                };

                localStorage.setItem(`radio_week_${weekKey}`, JSON.stringify(weekData));
                localStorage.setItem('radio_general', JSON.stringify(generalData));
                saveStatus.classList.remove('opacity-0');
                clearTimeout(saveTimeout);
                saveTimeout = setTimeout(() => saveStatus.classList.add('opacity-0'), 2000);
            }

            function loadGeneralData() {
                const generalData = JSON.parse(localStorage.getItem('radio_general'));
                if (generalData) {
                    document.getElementById('edu-admin').value = generalData.eduAdmin || '';
                    document.getElementById('school-name').value = generalData.schoolName || '';
                    document.getElementById('supervisor-name').value = generalData.supervisorName || '';
                    document.getElementById('manager-name').value = generalData.managerName || '';
                    if (generalData.selectedRegion) {
                        document.querySelector(`input[name="region"][value="${generalData.selectedRegion}"]`).checked = true;
                    }
                }
            }
            
            function loadWeekData(weekKey) {
                if (!weekKey) return;
                const weekData = JSON.parse(localStorage.getItem(`radio_week_${weekKey}`));
                const tableRows = tableContainer.querySelectorAll('tbody tr');
                if (weekData && tableRows.length) {
                    tableRows.forEach((row, index) => {
                        if (weekData[index] && !weekData[index].holiday) {
                            row.querySelector('.teacher-input').value = weekData[index].teacher || '';
                            row.querySelector('.status-select').value = weekData[index].status || 'نفذ';
                            row.querySelector('.signature-input').value = weekData[index].signature || '';
                        }
                    });
                }
            }

            // --- DATA (Academic Calendar 1447H) ---
            const academicWeeksData = {
                default: [
                    { semester: 1, value: 'week1', text: 'الأسبوع 1', dates: ['01 / 03', '02 / 03', '03 / 03', '04 / 03', '05 / 03'] },
                    { semester: 1, value: 'week2', text: 'الأسبوع 2', dates: ['08 / 03', '09 / 03', '10 / 03', '11 / 03', '12 / 03'] },
                    { semester: 1, value: 'week3', text: 'الأسبوع 3', dates: ['15 / 03', '16 / 03', '17 / 03', '18 / 03', '19 / 03'] },
                    { semester: 1, value: 'week4', text: 'الأسبوع 4', dates: ['22 / 03', '23 / 03', '24 / 03', '25 / 03', '26 / 03'] },
                    { semester: 1, value: 'week5', text: 'الأسبوع 5', dates: ['29 / 03', '30 / 03', '01 / 04', '02 / 04', '03 / 04'] },
                    { semester: 1, value: 'week6', text: 'الأسبوع 6', dates: ['06 / 04', '07 / 04', '08 / 04', '09 / 04', '10 / 04'] },
                    { semester: 1, value: 'week7', text: 'الأسبوع 7', dates: ['13 / 04', '14 / 04', '15 / 04', '16 / 04', '17 / 04'] },
                    { semester: 1, value: 'week8', text: 'الأسبوع 8', dates: ['20 / 04', '21 / 04', '22 / 04', '23 / 04', '24 / 04'] },
                    { semester: 1, value: 'week9', text: 'الأسبوع 9', dates: ['27 / 04', '28 / 04', '29 / 04', '30 / 04', '01 / 05'] },
                    { semester: 1, value: 'week10', text: 'الأسبوع 10', dates: ['04 / 05', '05 / 05', '06 / 05', '07 / 05', '08 / 05'] },
                    { semester: 1, value: 'week11', text: 'الأسبوع 11', dates: ['11 / 05', '12 / 05', '13 / 05', '14 / 05', '15 / 05'] },
                    { semester: 1, value: 'week12', text: 'الأسبوع 12', dates: ['18 / 05', '19 / 05', '20 / 05', '21 / 05', '22 / 05'] },
                    { semester: 1, value: 'week13', text: 'الأسبوع 13', dates: ['25 / 05', '26 / 05', '27 / 05', '28 / 05', '29 / 05'] },
                    { semester: 1, value: 'autumn_break', text: '-- إجازة الخريف --', dates: [] },
                    { semester: 1, value: 'week14', text: 'الأسبوع 14', dates: ['09 / 06', '10 / 06', '11 / 06', '12 / 06', '13 / 06'] },
                    { semester: 1, value: 'week15', text: 'الأسبوع 15', dates: ['16 / 06', '17 / 06', '18 / 06', '19 / 06', '20 / 06'] },
                    { semester: 1, value: 'week16', text: 'الأسبوع 16', dates: ['23 / 06', '24 / 06', '25 / 06', '26 / 06', '27 / 06'] },
                    { semester: 1, value: 'week17', text: 'الأسبوع 17', dates: ['01 / 07', '02 / 07', '03 / 07', '04 / 07', '05 / 07'] },
                    { semester: 1, value: 'week18', text: 'الأسبوع 18', dates: ['08 / 07', '09 / 07', '10 / 07', '11 / 07', '12 / 07'] },
                    { semester: 1, value: 'exams', text: '-- الاختبارات --', dates: ['15 / 07', '16 / 07', '17 / 07', '18 / 07', '19 / 07'] },
                    
                    { semester: 2, value: 's2_week1', text: 'الأسبوع 1', dates: ['29 / 07', '30 / 07', '01 / 08', '02 / 08', '03 / 08'] },
                    { semester: 2, value: 's2_week2', text: 'الأسبوع 2', dates: ['06 / 08', '07 / 08', '08 / 08', '09 / 08', '10 / 08'] },
                    { semester: 2, value: 's2_week3', text: 'الأسبوع 3', dates: ['13 / 08', '14 / 08', '15 / 08', '16 / 08', '17 / 08'] },
                    { semester: 2, value: 's2_week4', text: 'الأسبوع 4', dates: ['20 / 08', '21 / 08', '22 / 08', '23 / 08', '24 / 08'] },
                    { semester: 2, value: 's2_week5', text: 'الأسبوع 5', dates: ['27 / 08', '28 / 08', '29 / 08', '01 / 09', '02 / 09'] },
                    { semester: 2, value: 's2_week6', text: 'الأسبوع 6', dates: ['05 / 09', '06 / 09', '07 / 09', '08 / 09', '09 / 09'] },
                    { semester: 2, value: 's2_week7', text: 'الأسبوع 7', dates: ['12 / 09', '13 / 09', '14 / 09', '15 / 09', '16 / 09'] },
                    { semester: 2, value: 's2_eid_fitr', text: '-- عيد الفطر --', dates: [] },
                    { semester: 2, value: 's2_week8', text: 'الأسبوع 8', dates: ['10 / 10', '11 / 10', '12 / 10', '13 / 10', '14 / 10'] },
                    { semester: 2, value: 's2_week9', text: 'الأسبوع 9', dates: ['17 / 10', '18 / 10', '19 / 10', '20 / 10', '21 / 10'] },
                    { semester: 2, value: 's2_week10', text: 'الأسبوع 10', dates: ['24 / 10', '25 / 10', '26 / 10', '27 / 10', '28 / 10'] },
                    { semester: 2, value: 's2_week11', text: 'الأسبوع 11', dates: ['02 / 11', '03 / 11', '04 / 11', '05 / 11', '06 / 11'] },
                    { semester: 2, value: 's2_week12', text: 'الأسبوع 12', dates: ['09 / 11', '10 / 11', '11 / 11', '12 / 11', '13 / 11'] },
                    { semester: 2, value: 's2_week13', text: 'الأسبوع 13', dates: ['16 / 11', '17 / 11', '18 / 11', '19 / 11', '20 / 11'] },
                    { semester: 2, value: 's2_week14', text: 'الأسبوع 14', dates: ['23 / 11', '24 / 11', '25 / 11', '26 / 11', '27 / 11'] },
                    { semester: 2, value: 's2_week15', text: 'الأسبوع 15', dates: ['30 / 11', '01 / 12', '02 / 12', '03 / 12', '04 / 12'] },
                    { semester: 2, value: 's2_eid_adha', text: '-- عيد الأضحى --', dates: [] },
                    
                    // تعديل الأسبوع 16 لباقي المناطق (إدراج إجازة العيد)
                    { semester: 2, value: 's2_week16', text: 'الأسبوع 16', dates: ['14 / 12', '15 / 12', '16 / 12', '17 / 12', '18 / 12'] },
                    
                    { semester: 2, value: 's2_week17', text: 'الأسبوع 17', dates: ['21 / 12', '22 / 12', '23 / 12', '24 / 12', '25 / 12'] },
                    { semester: 2, value: 's2_week18', text: 'الأسبوع 18', dates: ['28 / 12', '29 / 12', '01 / 01', '02 / 01', '03 / 01'] }
                ],
                western: [
                    { semester: 1, value: 'week1', text: 'الأسبوع 1', dates: ['08 / 03', '09 / 03', '10 / 03', '11 / 03', '12 / 03'] },
                    { semester: 1, value: 'week2', text: 'الأسبوع 2', dates: ['15 / 03', '16 / 03', '17 / 03', '18 / 03', '19 / 03'] },
                    { semester: 1, value: 'week3', text: 'الأسبوع 3', dates: ['22 / 03', '23 / 03', '24 / 03', '25 / 03', '26 / 03'] },
                    { semester: 1, value: 'week4', text: 'الأسبوع 4', dates: ['29 / 03', '30 / 03', '04 / 01', '04 / 02', '04 / 03'] },
                    { semester: 1, value: 'week5', text: 'الأسبوع 5', dates: ['06 / 04', '07 / 04', '08 / 04', '09 / 04', '10 / 04'] },
                    { semester: 1, value: 'week6', text: 'الأسبوع 6', dates: ['13 / 04', '14 / 04', '15 / 04', '16 / 04', '17 / 04'] },
                    { semester: 1, value: 'week7', text: 'الأسبوع 7', dates: ['20 / 04', '21 / 04', '22 / 04', '23 / 04', '24 / 04'] },
                    { semester: 1, value: 'week8', text: 'الأسبوع 8', dates: ['27 / 04', '28 / 04', '29 / 04', '30 / 04', '01 / 05'] },
                    { semester: 1, value: 'week9', text: 'الأسبوع 9', dates: ['04 / 05', '05 / 05', '06 / 05', '07 / 05', '08 / 05'] },
                    { semester: 1, value: 'week10', text: 'الأسبوع 10', dates: ['11 / 05', '12 / 05', '13 / 05', '14 / 05', '15 / 05'] },
                    { semester: 1, value: 'week11', text: 'الأسبوع 11', dates: ['18 / 05', '19 / 05', '20 / 05', '21 / 05', '22 / 05'] },
                    { semester: 1, value: 'week12', text: 'الأسبوع 12', dates: ['25 / 05', '26 / 05', '27 / 05', '28 / 05', '29 / 05'] },
                    { semester: 1, value: 'autumn_break', text: '-- إجازة الخريف --', dates: [] },
                    { semester: 1, value: 'week13', text: 'الأسبوع 13', dates: ['09 / 06', '10 / 06', '11 / 06', '12 / 06', '13 / 06'] },
                    { semester: 1, value: 'week14', text: 'الأسبوع 14', dates: ['16 / 06', '17 / 06', '18 / 06', '19 / 06', '20 / 06'] },
                    { semester: 1, value: 'week15', text: 'الأسبوع 15', dates: ['23 / 06', '24 / 06', '25 / 06', '26 / 06', '27 / 06'] },
                    { semester: 1, value: 'week16', text: 'الأسبوع 16', dates: ['01 / 07', '02 / 07', '03 / 07', '04 / 07', '05 / 07'] },
                    { semester: 1, value: 'week17', text: 'الأسبوع 17', dates: ['08 / 07', '09 / 07', '10 / 07', '11 / 07', '12 / 07'] },
                    { semester: 1, value: 'exams', text: '-- الاختبارات --', dates: ['15 / 07', '16 / 07', '17 / 07', '18 / 07', '19 / 07'] },
                    
                    { semester: 2, value: 's2_week1', text: 'الأسبوع 1', dates: ['29 / 07', '30 / 07', '01 / 08', '02 / 08', '03 / 08'] },
                    { semester: 2, value: 's2_week2', text: 'الأسبوع 2', dates: ['06 / 08', '07 / 08', '08 / 08', '09 / 08', '10 / 08'] },
                    { semester: 2, value: 's2_week3', text: 'الأسبوع 3', dates: ['13 / 08', '14 / 08', '15 / 08', '16 / 08', '17 / 08'] },
                    { semester: 2, value: 's2_week4', text: 'الأسبوع 4', dates: ['20 / 08', '21 / 08', '22 / 08', '23 / 08', '24 / 08'] },
                    { semester: 2, value: 's2_week5', text: 'الأسبوع 5', dates: ['27 / 08', '28 / 08', '29 / 08', '01 / 09', '02 / 09'] },
                    { semester: 2, value: 's2_week6', text: 'الأسبوع 6', dates: ['05 / 09', '06 / 09', '07 / 09', '08 / 09', '09 / 09'] },
                    { semester: 2, value: 's2_week7', text: 'الأسبوع 7', dates: ['12 / 09', '13 / 09', '14 / 09', '15 / 09', '16 / 09'] },
                    { semester: 2, value: 's2_eid_fitr', text: '-- عيد الفطر --', dates: [] },
                    { semester: 2, value: 's2_week8', text: 'الأسبوع 8', dates: ['10 / 10', '11 / 10', '12 / 10', '13 / 10', '14 / 10'] },
                    { semester: 2, value: 's2_week9', text: 'الأسبوع 9', dates: ['17 / 10', '18 / 10', '19 / 10', '20 / 10', '21 / 10'] },
                    { semester: 2, value: 's2_week10', text: 'الأسبوع 10', dates: ['24 / 10', '25 / 10', '26 / 10', '27 / 10', '28 / 10'] },
                    { semester: 2, value: 's2_week11', text: 'الأسبوع 11', dates: ['02 / 11', '03 / 11', '04 / 11', '05 / 11', '06 / 11'] },
                    { semester: 2, value: 's2_week12', text: 'الأسبوع 12', dates: ['09 / 11', '10 / 11', '11 / 11', '12 / 11', '13 / 11'] },
                    { semester: 2, value: 's2_week13', text: 'الأسبوع 13', dates: ['16 / 11', '17 / 11', '18 / 11', '19 / 11', '20 / 11'] },
                    { semester: 2, value: 's2_week14', text: 'الأسبوع 14', dates: ['23 / 11', '24 / 11', '25 / 11', '26 / 11', '27 / 11'] },
                    
                    { semester: 2, value: 's2_eid_adha', text: '-- عيد الأضحى (27/11 - 15/12) --', dates: [] },
                    
                    // الأسبوع 15 للمنطقة الغربية (عودة من إجازة الأضحى)
                    { semester: 2, value: 's2_week15', text: 'الأسبوع 15', dates: ['14 / 12', '15 / 12', '16 / 12', '17 / 12', '18 / 12'] },
                    { semester: 2, value: 's2_week16', text: 'الأسبوع 16', dates: ['21 / 12', '22 / 12', '23 / 12', '24 / 12', '25 / 12'] },
                    { semester: 2, value: 's2_week17', text: 'الأسبوع 17', dates: ['28 / 12', '29 / 12', '01 / 01', '02 / 01', '03 / 01'] },
                    { semester: 2, value: 's2_week18', text: 'الأسبوع 18', dates: ['06 / 01', '07 / 01', '08 / 01', '09 / 01', '10 / 01'] }
                ]
            };

            const holidays = {
                '01 / 04': { text: 'يوم وطني', color: 'bg-green-100' },
                '20 / 04': { text: 'مطولة', color: 'bg-red-100' },
                '20 / 06': { text: 'مطولة', color: 'bg-red-100' },
                '23 / 06': { text: 'مطولة', color: 'bg-red-100' },
                '05 / 09': { text: 'يوم التأسيس', color: 'bg-green-100' },
                // إجازات العيد لتوحيد الجدول بين المنطقتين
                '14 / 12': { text: 'إجازة عيد الأضحى', color: 'bg-green-100' },
                '15 / 12': { text: 'إجازة عيد الأضحى', color: 'bg-green-100' }
            };

            function populateWeeks() {
                const region = document.querySelector('input[name="region"]:checked').value;
                const selectedSemester = parseInt(semesterSelector.value);
                weekSelector.innerHTML = '<option value="">الرجاء اختيار أسبوع</option>';
                const weeks = academicWeeksData[region];
                const filteredWeeks = weeks.filter(week => week.semester === selectedSemester);
                filteredWeeks.forEach(week => {
                    const option = document.createElement('option');
                    option.value = week.value;
                    option.textContent = week.text;
                    weekSelector.appendChild(option);
                });
            }
            
            function generateTableForWeek(weekValue) {
                if (!weekValue) {
                    tableContainer.innerHTML = '';
                    tableTitle.textContent = 'اختر أسبوعًا لعرض الجدول';
                    return;
                }
                const region = document.querySelector('input[name="region"]:checked').value;
                const selectedWeek = academicWeeksData[region].find(w => w.value === weekValue);
                if (selectedWeek.dates.length === 0) {
                     tableTitle.textContent = selectedWeek.text;
                     tableContainer.innerHTML = `<div class="p-8 text-center text-xl font-bold text-gray-600 bg-gray-50 border rounded">${selectedWeek.text.replace(/---/g, '')}</div>`;
                     return;
                }
                tableTitle.textContent = `جدول الإذاعة لـ ${selectedWeek.text}`;
                let tableHTML = `<table class="min-w-full bg-white border border-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="py-3 px-4 border text-center">اليوم</th><th class="py-3 px-4 border text-center">التاريخ</th>
                                <th class="py-3 px-4 border text-center">اسم المعلم/ـة</th><th class="py-3 px-4 border text-center">التنفيذ</th>
                                <th class="py-3 px-4 border text-center">التوقيع</th>
                            </tr>
                        </thead><tbody>`;
                let dateIndex = 0;
                let loopStart = 0;
                if (selectedWeek.dates.length === 3 && selectedWeek.dates[0] !== selectedWeek.dates[1]) {
                    loopStart = 2;
                }
                for (let i = 0; i < 5; i++) {
                    if (i < loopStart || dateIndex >= selectedWeek.dates.length) continue;
                    const dateString = selectedWeek.dates[dateIndex];
                    dateIndex++;
                    
                    let rowHtml = `<tr class="text-center"><td class="py-3 px-4 border">${dayNames[i]}</td><td class="py-3 px-4 border">${dateString}</td>`;
                    
                    if (holidays[dateString]) {
                        rowHtml = `<tr class="text-center holiday-row ${holidays[dateString].color}">
                            <td class="py-3 px-4 border">${dayNames[i]}</td>
                            <td class="py-3 px-4 border">${dateString}</td>
                            <td class="py-3 px-4 border font-bold" colspan="3">${holidays[dateString].text}</td>
                        </tr>`;
                    } else {
                        rowHtml += `<td class="py-3 px-4 border"><input type="text" class="teacher-input w-full text-center border-none focus:ring-0 bg-transparent"></td>
                                <td class="py-3 px-4 border"><select class="status-select w-full text-center border-none focus:ring-0 bg-transparent">
                                        <option value="نفذ">نفذ</option><option value="لم ينفذ">لم ينفذ</option></select></td>
                                <td class="py-3 px-4 border"><input type="text" class="signature-input w-full text-center border-none focus:ring-0 bg-transparent"></td>
                            </tr>`;
                    }
                    tableHTML += rowHtml;
                }
                tableHTML += `</tbody></table>`;
                tableContainer.innerHTML = tableHTML;
                tableContainer.querySelectorAll('input, select').forEach(el => el.addEventListener('input', saveData));
                loadWeekData(weekValue);
            }

            // --- SMART PRINT LOGIC (2 Pages) ---
            function prepareAndPrintSelectedSemester() {
                const eduAdminVal = document.getElementById('edu-admin').value;
                const schoolNameVal = document.getElementById('school-name').value;
                const supervisorNameVal = document.getElementById('supervisor-name').value;
                const managerNameVal = document.getElementById('manager-name').value;
                const selectedRegion = document.querySelector('input[name="region"]:checked').value;
                const selectedSemester = parseInt(semesterSelector.value);
                const semesterTitle = selectedSemester === 1 ? 'الفصل الدراسي الأول' : 'الفصل الدراسي الثاني';
                
                const allWeeks = academicWeeksData[selectedRegion];
                let weeksToPrint = allWeeks.filter(w => w.semester === selectedSemester);
                weeksToPrint = weeksToPrint.filter(w => w.dates.length > 0);

                let schoolInfoHTML = '';
                if (eduAdminVal) schoolInfoHTML += `<p>${eduAdminVal}</p>`;
                if (schoolNameVal) schoolInfoHTML += `<p style="color: #28a745 !important; font-weight: bold;">${schoolNameVal}</p>`;

                function getWeekCardHTML(week) {
                    const weekKey = week.value;
                    let weekData = JSON.parse(localStorage.getItem(`radio_week_${weekKey}`)) || Array(5).fill({ teacher: '', status: 'نفذ', signature: '' });
                    
                    let tableRows = '';
                    let dateIndex = 0;
                    let loopStart = 0;
                    if (week.dates.length === 3 && week.dates[0] !== week.dates[1]) loopStart = 2;

                    for (let i = 0; i < 5; i++) {
                        if (i < loopStart || dateIndex >= week.dates.length) continue;
                        const dateString = week.dates[dateIndex];
                        const dayData = weekData[dateIndex] || {};
                        dateIndex++;
                        
                        if (holidays[dateString]) {
                            tableRows += `<tr style="background-color:${holidays[dateString].color==='bg-green-100'?'#d4edda':'#f8d7da'} !important;"><td colspan="5" style="font-weight:bold;">${holidays[dateString].text} (${dateString})</td></tr>`;
                        } else {
                            let statusHtml = dayData.teacher ? (dayData.status==='نفذ'?'<span style="color:green">✔</span>':'<span style="color:red">✖</span>') : '';
                            tableRows += `<tr>
                                <td style="width:15%">${dayNames[i]}</td>
                                <td style="width:15%">${dateString}</td>
                                <td>${dayData.teacher || ''}</td>
                                <td style="width:10%">${statusHtml}</td>
                                <td style="width:15%">${dayData.signature || ''}</td>
                            </tr>`;
                        }
                    }
                    return `<div class="week-container">
                        <h3>${week.text}</h3>
                        <table>
                            <thead><tr><th>اليوم</th><th>التاريخ</th><th>المعلم</th><th>حالة</th><th>توقيع</th></tr></thead>
                            <tbody>${tableRows}</tbody>
                        </table>
                    </div>`;
                }

                const chunks = [];
                for (let i = 0; i < weeksToPrint.length; i += 9) {
                    chunks.push(weeksToPrint.slice(i, i + 9));
                }

                let pagesHTML = '';
                chunks.forEach((chunk, index) => {
                    let gridHTML = chunk.map(w => getWeekCardHTML(w)).join('');
                    pagesHTML += `
                    <div class="print-page">
                        <div class="print-header">
                            <div class="header-content">
                                <h1>متابعة الإذاعة - ${semesterTitle} (${index+1})</h1>
                                <div class="school-info">${schoolInfoHTML}</div>
                                <img src="https://j.top4top.io/p_3516qltr40.png" class="logo">
                            </div>
                        </div>
                        <div class="grid-container">${gridHTML}</div>
                        <div class="print-footer">
                            <div class="signatures">
                                <div>مشرف الإذاعة: ${supervisorNameVal}</div>
                                <div>مدير المدرسة: ${managerNameVal}</div>
                            </div>
                        </div>
                    </div>`;
                });

                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <html><head><title>طباعة</title>
                    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
                    <style>
                        * { -webkit-print-color-adjust: exact !important; color-adjust: exact !important; box-sizing: border-box; }
                        body { font-family: 'Cairo', sans-serif; margin: 0; padding: 0; direction: rtl; background: #fff; }
                        @page { size: A4 landscape; margin: 0; }
                        
                        .print-page { width: 297mm; height: 210mm; page-break-after: always; display: flex; flex-direction: column; padding: 5mm; overflow: hidden; }
                        .print-header { height: 12mm; background-color: #003a46; color: white; padding: 0 10mm; border-radius: 5px; margin-bottom: 2mm; display: flex; align-items: center; }
                        .header-content { display: flex; justify-content: space-between; align-items: center; width: 100%; }
                        .header-content h1 { font-size: 14pt; margin: 0; }
                        .school-info p { margin: 0; font-size: 10pt; text-align: left; }
                        .logo { height: 10mm; }

                        .grid-container { display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr); gap: 3mm; flex-grow: 1; }
                        .week-container { border: 1px solid #ccc; border-radius: 4px; display: flex; flex-direction: column; overflow: hidden; }
                        .week-container h3 { margin: 0; background: #eee; font-size: 9pt; text-align: center; padding: 1px 0; border-bottom: 1px solid #ccc; }
                        table { width: 100%; border-collapse: collapse; font-size: 8pt; flex-grow: 1; }
                        th, td { border: 1px solid #eee; text-align: center; padding: 0; height: 14px; }
                        th { background: #f9f9f9; font-weight: bold; }
                        
                        .print-footer { height: 10mm; margin-top: 2mm; border-top: 2px solid #34ad82; display: flex; align-items: center; justify-content: center; }
                        .signatures { display: flex; gap: 50mm; font-size: 10pt; font-weight: bold; }
                    </style>
                    </head><body>${pagesHTML}</body></html>`);
                printWindow.document.close();
                setTimeout(() => { printWindow.print(); printWindow.close(); }, 500);
            }

            // --- EVENT LISTENERS ---
            document.getElementById('edu-admin').addEventListener('input', saveData);
            document.getElementById('school-name').addEventListener('input', saveData);
            document.getElementById('supervisor-name').addEventListener('input', saveData);
            document.getElementById('manager-name').addEventListener('input', saveData);

            weekSelector.addEventListener('change', (e) => generateTableForWeek(e.target.value));
            semesterSelector.addEventListener('change', () => {
                populateWeeks();
                generateTableForWeek(null);
            });
            printButton.addEventListener('click', prepareAndPrintSelectedSemester);
            clearButton.addEventListener('click', () => {
                showConfirm('هل أنت متأكد من رغبتك في مسح جميع البيانات المحفوظة؟', () => {
                    localStorage.clear();
                    location.reload();
                });
            });
            confirmNo.addEventListener('click', () => confirmModal.classList.add('hidden'));
            confirmYes.addEventListener('click', () => {
                if (confirmCallback) confirmCallback();
                confirmModal.classList.add('hidden');
            });
            regionRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    populateWeeks();
                    generateTableForWeek(null); 
                    saveData();
                });
            });
            
            loadGeneralData();
            populateWeeks();
            generateTableForWeek(null);
        });
    </script>
</body>
</html>
